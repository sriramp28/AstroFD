\documentclass[11pt]{article}
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{hyperref}
\geometry{margin=1in}

\title{AstroFD: Relativistic Jet and SN-lite Solver}
\author{AstroFD Contributors}
\date{\today}

\begin{document}
\maketitle

\begin{abstract}
AstroFD is a finite-volume solver for relativistic hydrodynamics and
magnetohydrodynamics in flat spacetime and on fixed curved backgrounds.
The code targets relativistic jet simulations and SN-lite core-collapse
scenarios with configurable nozzle injection, GLM divergence cleaning,
causal dissipation, two-temperature relaxation, non-ideal MHD extensions,
H/He non-equilibrium chemistry, and parametric neutrino heating. This
report documents the governing equations, numerical methods, physical
modules, diagnostics, and validation tests.
\end{abstract}

\section{Introduction}
Relativistic jets and core-collapse flows exhibit strong shocks, large
Lorentz factors, magnetic stresses, and stiff source terms. AstroFD is
built as a modular research code for controlled studies of these regimes.
It combines robust conservative discretizations with optional high-order
reconstruction and flexible physics modules.

\section{Physical Background and Literature}
Relativistic jet modeling is rooted in SRHD and RMHD formulations that
capture ultrarelativistic flows, shock propagation, and magnetic stress
transport \cite{marti1999, anile1989, komissarov1999}. The standard
formulation for GRHD/GRMHD uses the Valencia 3+1 split
\cite{banyuls1997, font2008} and has been validated in astrophysical
codes such as HARM \cite{gammie2003} and ECHO \cite{delzanna2007}.

For ideal MHD, divergence control is required to maintain
$\nabla \cdot \mathbf{B} = 0$; GLM cleaning provides a robust approach
\cite{dedner2002, mignone2010}. High-order reconstruction methods such as
PPM and WENO improve accuracy in smooth regions while retaining stability
at discontinuities \cite{colella1984, jiang1996}. Time integration with
SSPRK schemes provides strong-stability-preserving updates for
hyperbolic systems \cite{gottlieb2001}.

SN-lite physics follows parametric heating and cooling models commonly
used in core-collapse studies \cite{janka2001, janka2012}. Causal
relativistic dissipation adopts Israel-Stewart formulations
\cite{israel1979, rezolla2013}. Resistive and non-ideal MHD terms provide
controlled explorations of reconnection and drift physics
\cite{palenzuela2009}.

\section{Notation and Variables}
We use units with $c = 1$ and metric signature $(-,+,+,+)$. Greek indices
represent spacetime components and Latin indices represent spatial
components. The 4-velocity is $u^\mu$, Lorentz factor is
$W = (1 - v^2)^{-1/2}$, and the specific enthalpy is
$h = 1 + e + p/\rho$. The ideal-gas EOS is $p = (\gamma - 1) \rho e$.

\begin{table}[h]
\centering
\begin{tabular}{l l}
\hline
Symbol & Meaning \\
\hline
$\rho$ & rest-mass density \\
$e$ & specific internal energy \\
$p$ & thermal pressure \\
$u^\mu$ & 4-velocity \\
$v^i$ & 3-velocity \\
$W$ & Lorentz factor \\
$h$ & specific enthalpy \\
$T^{\mu\nu}$ & stress-energy tensor \\
$B^i$ & magnetic field \\
$b^\mu$ & magnetic 4-vector \\
$\alpha$ & lapse \\
$\beta^i$ & shift \\
$\gamma_{ij}$ & spatial metric \\
$\gamma$ & determinant of $\gamma_{ij}$ \\
$\psi$ & GLM cleaning scalar \\
\hline
\end{tabular}
\caption{Notation used in the governing equations.}
\label{tab:notation}
\end{table}

\section{Governing Equations}
\subsection{SRHD: Conservation Laws}
The covariant SRHD equations are
\begin{align}
\nabla_\mu (\rho u^\mu) &= 0, \\
\nabla_\mu T^{\mu\nu} &= 0,
\end{align}
with stress-energy tensor
\begin{equation}
T^{\mu\nu} = \rho h u^\mu u^\nu + p g^{\mu\nu}.
\end{equation}
In 3+1 form, the conserved variables are
\begin{align}
D &= \rho W, \\
S_i &= \rho h W^2 v_i, \\
\tau &= \rho h W^2 - p - D,
\end{align}
and the evolution equation is
\begin{equation}
\partial_t U + \partial_i F^i(U) = S(U),
\end{equation}
where $U = (D, S_i, \tau)$, $F^i$ are the conservative fluxes, and $S$
contains geometric and physical source terms (zero in flat SRHD).

\subsection{RMHD: Ideal MHD and GLM Cleaning}
Ideal RMHD adds Maxwell equations and the ideal constraint
$F^{\mu\nu} u_\nu = 0$, with
\begin{align}
\nabla_\mu {^*F}^{\mu\nu} &= 0, \\
\nabla_\mu F^{\mu\nu} &= J^\nu.
\end{align}
The stress-energy tensor becomes
\begin{equation}
T^{\mu\nu} = (\rho h + b^2) u^\mu u^\nu + \left(p + \frac{b^2}{2}\right) g^{\mu\nu} - b^\mu b^\nu,
\end{equation}
where $b^\mu$ is the magnetic 4-vector and $b^2 = b^\mu b_\mu$.
The conservative variables include $B^i$ and the GLM scalar $\psi$.
GLM cleaning uses
\begin{align}
\partial_t \mathbf{B} + \nabla \times \mathbf{E} + \nabla \psi &= 0, \\
\partial_t \psi + c_h^2 \nabla \cdot \mathbf{B} &= -c_p^2 \psi,
\end{align}
with hyperbolic cleaning speed $c_h$ and damping $c_p$.

\subsection{GRHD/GRMHD: Valencia Form}
For fixed backgrounds, we use the 3+1 split with lapse $\alpha$, shift
$\beta^i$, and spatial metric $\gamma_{ij}$. The conservative update is
\begin{equation}
\partial_t (\sqrt{\gamma} U) + \partial_i (\sqrt{\gamma} F^i) = \sqrt{\gamma} S,
\end{equation}
where $U$ and $F^i$ include the GR corrections and $S$ collects metric
source terms. The GRMHD stress-energy tensor uses the RMHD form, with
metric contractions performed using $g_{\mu\nu}$.

\subsection{Causal Dissipation}
We evolve bulk pressure $\Pi$, shear stress $\pi^{\mu\nu}$, and heat flux
$q^\mu$ with Israel--Stewart-type relaxation
\cite{israel1979, rezolla2013}:
\begin{align}
\tau_\Pi u^\alpha \nabla_\alpha \Pi + \Pi &= -\zeta \nabla_\alpha u^\alpha, \\
\tau_\pi u^\alpha \nabla_\alpha \pi^{\mu\nu} + \pi^{\mu\nu} &= 2 \eta \sigma^{\mu\nu}, \\
\tau_q u^\alpha \nabla_\alpha q^\mu + q^\mu &= -\kappa T \Delta^{\mu\nu} \nabla_\nu T,
\end{align}
where $\Delta^{\mu\nu} = g^{\mu\nu} + u^\mu u^\nu$ and
$\sigma^{\mu\nu}$ is the shear tensor.

\subsection{Two-Temperature Relaxation}
Electron and ion internal energies evolve with relaxation time $\tau_{ei}$:
\begin{align}
\partial_t (\rho e_e) + \nabla \cdot (\rho e_e \mathbf{v}) &= \rho \frac{e_i - e_e}{\tau_{ei}}, \\
\partial_t (\rho e_i) + \nabla \cdot (\rho e_i \mathbf{v}) &= \rho \frac{e_e - e_i}{\tau_{ei}}.
\end{align}

\subsection{H/He Non-Equilibrium Chemistry}
Species mass fractions $X_s$ satisfy
\begin{equation}
\partial_t (\rho X_s) + \nabla \cdot (\rho X_s \mathbf{v}) = \rho \dot{X}_s,
\end{equation}
with source terms $\dot{X}_s$ determined by ionization and recombination
rates \cite{anninos1997}.

\subsection{Passive Tracers}
Passive tracers $C_k$ obey
\begin{equation}
\partial_t (\rho C_k) + \nabla \cdot (\rho C_k \mathbf{v}) = 0,
\end{equation}
with inlet and ambient values set by configuration.

\subsection{Resistive and Non-Ideal MHD}
Resistive MHD uses Ohm's law
\begin{equation}
\mathbf{E} + \mathbf{v} \times \mathbf{B} = \eta \mathbf{J},
\end{equation}
with $\mathbf{J} = \nabla \times \mathbf{B}$. Optional non-ideal terms
include Hall and ambipolar contributions for controlled experiments
\cite{palenzuela2009}.

\subsection{SN-lite Source Terms}
SN-lite physics applies Newtonian gravity and parametric heating/cooling.
The momentum source is $\rho \mathbf{g}$ with $\mathbf{g} = -\nabla \Phi$,
and the energy source uses a net heating rate
\begin{equation}
\dot{e} = Q^+(r, \rho, T) - Q^-(r, \rho, T),
\end{equation}
including optional lightbulb neutrino deposition \cite{janka2001}.

\section{Numerical Methods}
\subsection{Finite-Volume Discretization}
We update cell-averaged conserved variables on a Cartesian mesh with
ghost zones. The semi-discrete update is
\begin{equation}
\frac{d U_{i,j,k}}{dt} = -\frac{F^x_{i+1/2,j,k} - F^x_{i-1/2,j,k}}{\Delta x}
-\frac{F^y_{i,j+1/2,k} - F^y_{i,j-1/2,k}}{\Delta y}
-\frac{F^z_{i,j,k+1/2} - F^z_{i,j,k-1/2}}{\Delta z} + S_{i,j,k}.
\end{equation}

\subsection{Reconstruction}
Reconstruction options include MUSCL with MC/minmod/van Leer limiters,
PPM \cite{colella1984}, and WENO5 \cite{jiang1996}. Primitive variables
are reconstructed to cell faces before Riemann solves.

\subsection{Riemann Solvers}
HLLE provides a robust baseline. HLLC is used for hydro, and HLLD/full
HLLD for RMHD \cite{toro1999, miyoshi2005}. The solver is selected at
runtime.

\subsection{Time Integration}
We support SSPRK2 and SSPRK3 integration \cite{gottlieb2001}.
SSPRK2 uses
\begin{align}
U^{(1)} &= U^n + \Delta t L(U^n), \\
U^{n+1} &= \frac{1}{2} U^n + \frac{1}{2} \left(U^{(1)} + \Delta t L(U^{(1)})\right),
\end{align}
while SSPRK3 uses the standard three-stage formulation.

\subsection{Source Term Coupling and IMEX}
Source terms are applied with operator splitting. For stiff terms (e.g.,
causal dissipation), we use subcycled IMEX updates of the form
\begin{align}
U^* &= U^n + \Delta t L(U^n), \\
U^{n+1} &= U^* + \Delta t S(U^{n+1}),
\end{align}
with implicit treatment of $S$ over short substeps.

\subsection{Primitive Recovery}
Primitive recovery solves for $(\rho, p, v_i)$ given the conservative
state. RMHD recovery uses iterative inversion with fallback strategies
\cite{noble2006}.

\subsection{Floors, Caps, and Stability Controls}
Density and pressure floors enforce positivity. Velocity caps limit $v$
close to $c$ to avoid numerical blow-up. These controls are configurable
and can be tightened during early testing.

\section{Algorithm Summary}
A single timestep proceeds as:
\begin{enumerate}
  \item Apply boundary conditions and nozzle inflow.
  \item Reconstruct primitives to faces (MUSCL/PPM/WENO).
  \item Solve Riemann problems at faces and compute fluxes.
  \item Update conserved variables with flux divergence.
  \item Apply source terms (gravity, GLM damping, dissipation, chemistry).
  \item Recover primitives and enforce floors/caps.
  \item Write diagnostics and outputs as configured.
\end{enumerate}

\section{Boundary Conditions and Injection}
Jet inflow is imposed at the x-min boundary with configurable nozzle
profiles (top-hat, taper, parabolic) and optional perturbations to seed
instabilities. The nozzle includes a shear layer of configurable
thickness and optional magnetic fields (poloidal or toroidal) at the
inlet.

\section{Diagnostics}
Diagnostics include maximum Lorentz factor, inlet energy and momentum
fluxes, centerline profiles, divB statistics, SN shock radius and gain
mass, cocoon pressure, mixing layer thickness, and optional performance
counters. Diagnostics are written as CSV files in each run directory.

\section{Validation}
Validation suites cover reconstruction and limiter behavior, Riemann
solver checks, GR Kerr-Schild runs, orthonormal flux evaluation, restart
regression, and SN-lite tests (freefall, Sedov, stalled shock, and
lightbulb heating). These tests are automated in \texttt{tools/}.

\section{Configuration and Reproducibility}
All physics and numerics options are set through JSON configuration
files. Outputs are organized by timestamp under \texttt{results/}. The
code records diagnostics in CSV for post-processing and comparison.

\subsection{Recommended Configuration Table}
Table \ref{tab:config-summary} lists a compact reference of commonly
used configuration switches and suggested values for jets and SN-lite.

\begin{table}[h]
\centering
\begin{tabular}{l l l}
\hline
Key & Jet default & SN-lite default \\
\hline
PHYSICS & rmhd & sn \\
RECON & ppm & muscl \\
RIEMANN & hlld\_full & hlle \\
RK\_ORDER & 3 & 2 \\
GLM\_CH, GLM\_CP & 1.0, 0.1 & n/a \\
TWO\_TEMPERATURE & true & true \\
CHEMISTRY\_ENABLED & true & true \\
RESISTIVE\_ENABLED & false & false \\
NEUTRINO\_ENABLED & false & true \\
\hline
\end{tabular}
\caption{Compact configuration reference for typical jet and SN-lite runs.}
\label{tab:config-summary}
\end{table}

\section{Example Workflows and Results}
This section includes example figures and a compact diagnostics summary
table generated from the latest validation run. The figures can be
regenerated with \texttt{tools/make\_doc\_figures.py}.

\subsection{Jet Propagation Snapshot}
\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth]{figures/jet_rho_midZ.png}
\caption{Jet density slice at mid-Z from the latest run.}
\end{figure}

\subsection{Centerline Lorentz Factor}
\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth]{figures/centerline_gamma.png}
\caption{Centerline Lorentz factor profile from the latest run.}
\end{figure}

\subsection{RMHD divB Control}
\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth]{figures/divb_max.png}
\caption{divB max over time from the latest RMHD run segment.}
\end{figure}

\subsection{SN-lite Shock Evolution}
\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth]{figures/sn_shock_radius.png}
\caption{SN-lite shock radius evolution from the latest run segment.}
\end{figure}

\subsection{Diagnostics Summary Table}
\input{figures/validation_summary.tex}

\appendix
\section{Paper Template Checklist}
\subsection{Recommended Figures}
\begin{itemize}
  \item Jet density slice and Lorentz factor centerline profile.
  \item RMHD divB control over time for representative runs.
  \item Shock radius evolution for SN-lite scenarios.
  \item Resolution study comparing MUSCL/PPM/WENO convergence.
  \item GR metric validation plots (e.g., Kerr-Schild test case).
\end{itemize}

\subsection{Recommended Tables}
\begin{itemize}
  \item Configuration summary for each experiment class.
  \item Diagnostics summary (max Gamma, divB, shock radius).
  \item Convergence errors for scheme comparisons.
\end{itemize}

\subsection{Results Checklist}
\begin{itemize}
  \item State the EOS, reconstruction, Riemann solver, and time integrator.
  \item Report CFL, grid resolution, and runtime stability settings.
  \item Provide divB statistics for RMHD/GRMHD runs.
  \item Report shock radius and heating efficiency for SN-lite runs.
  \item Include convergence or resolution-sensitivity tests.
  \item Archive configs and diagnostics alongside plots.
\end{itemize}

\section{Limitations and Future Work}
Current limitations include static nested refinement (single rank),
limited GRMHD benchmark coverage, and incomplete GPU acceleration for
solver kernels. Planned improvements include expanded EOS options,
quantitative convergence tests, and additional validation problems.

\bibliographystyle{unsrt}
\bibliography{astrofd_refs}

\end{document}
