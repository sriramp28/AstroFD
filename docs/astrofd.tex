\documentclass[11pt]{article}
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{makecell}
\geometry{margin=1in}

\title{AstroFD: A Relativistic Jet and SN-lite Solver for Modular Physics Studies}
\author{Sriram P. Kalathoor\thanks{Daniel Guggenheim School of Aerospace Engineering, Georgia Institute of Technology}}
\date{\today}

\begin{document}
\maketitle

\begin{abstract}
AstroFD is a finite-volume solver for relativistic hydrodynamics and
magnetohydrodynamics in flat spacetime and on fixed curved backgrounds.
It targets relativistic jet simulations and SN-lite core-collapse
scenarios with configurable nozzle injection, GLM divergence cleaning,
causal dissipation, two-temperature relaxation, non-ideal MHD extensions,
H/He non-equilibrium chemistry, and parametric neutrino heating. We
present the governing equations, numerical methods, and validation
procedures, emphasizing a modular design that enables controlled
comparisons across physics closures and numerical options.
\end{abstract}

\section{Introduction}
Relativistic jets and core-collapse flows exhibit strong shocks, large
Lorentz factors, magnetic stresses, and stiff source terms. Numerical
models must balance robustness, accuracy, and transparency in order to
support systematic studies across physical assumptions. AstroFD is
constructed as a modular research code with a clear separation between
conservative hyperbolic updates and optional source-term physics, so that
individual closures can be enabled, validated, and compared in isolation.

The present paper documents the physical and numerical formulation of
AstroFD and provides a reproducible baseline for future extensions. The
current implementation assumes fixed spacetime metrics for GRHD/GRMHD and
parameterized heating/cooling for SN-lite studies; these choices are
made explicitly to enable controlled experiments and to facilitate rapid
parameter sweeps. Extensions to higher-fidelity transport and dynamic
spacetime evolution are planned and are discussed in Section
\ref{sec:discussion}.

\section{Related Work}
Relativistic jet modeling is commonly built on SRHD and RMHD
formulations \cite{marti1999, anile1989, komissarov1999}. The Valencia
3+1 split underlies many GRHD/GRMHD implementations
\cite{banyuls1997, font2008}, including production codes such as HARM and
ECHO \cite{gammie2003, delzanna2007}. Divergence control in MHD is often
handled by constrained transport or GLM cleaning \cite{dedner2002,
mignone2010}. High-order reconstruction (e.g., PPM, WENO) and SSPRK time
integration are standard in shock-capturing schemes
\cite{colella1984, jiang1996, gottlieb2001}.

For SN-lite modeling, parameterized heating and cooling prescriptions are
widely used to study qualitative shock dynamics and gain-region behavior
\cite{janka2001, janka2012}. Causal dissipation follows Israel--Stewart
formulations \cite{israel1979, rezolla2013}, and resistive or non-ideal
MHD extensions enable controlled explorations of reconnection physics
\cite{palenzuela2009}. AstroFD positions itself as a modular, transparent
code that consolidates these components within a single, configurable
framework, facilitating reproducible comparisons between models.

\section{Methods}
\subsection{Notation and Variables}
We use units with $c = 1$ and metric signature $(-,+,+,+)$. Greek indices
represent spacetime components and Latin indices represent spatial
components. The 4-velocity is $u^\mu$, Lorentz factor is
$W = (1 - v^2)^{-1/2}$, and the specific enthalpy is
$h = 1 + e + p/\rho$. The ideal-gas EOS is $p = (\gamma - 1) \rho e$.

\begin{table}[ht]
\centering
\begin{tabular}{l l}
\hline
Symbol & Meaning \\
\hline
$\rho$ & rest-mass density \\
$e$ & specific internal energy \\
$p$ & thermal pressure \\
$u^\mu$ & 4-velocity \\
$v^i$ & 3-velocity \\
$W$ & Lorentz factor \\
$h$ & specific enthalpy \\
$T^{\mu\nu}$ & stress-energy tensor \\
$B^i$ & magnetic field (lab frame) \\
$b^\mu$ & magnetic 4-vector \\
$\alpha$ & lapse \\
$\beta^i$ & shift \\
$\gamma_{ij}$ & spatial metric \\
$\gamma$ & determinant of $\gamma_{ij}$ \\
$\psi$ & GLM cleaning scalar \\
$\Pi$ & bulk viscous pressure \\
$\pi^{\mu\nu}$ & shear stress \\
$q^\mu$ & heat flux \\
\hline
\end{tabular}
\caption{Notation used in the governing equations.}
\label{tab:notation}
\end{table}

\subsection{Governing Equations}
\subsubsection{SRHD}
The covariant SRHD equations are
\begin{align}
\nabla_\mu (\rho u^\mu) &= 0, \\
\nabla_\mu T^{\mu\nu} &= 0,
\end{align}
with stress-energy tensor
\begin{equation}
T^{\mu\nu} = \rho h u^\mu u^\nu + p g^{\mu\nu}.
\end{equation}
In 3+1 form, the conserved variables are
\begin{align}
D &= \rho W, \\
S_i &= \rho h W^2 v_i, \\
\tau &= \rho h W^2 - p - D,
\end{align}
and the evolution equation is
\begin{equation}
\partial_t U + \partial_i F^i(U) = S(U),
\end{equation}
where $U = (D, S_i, \tau)$, $F^i$ are the conservative fluxes, and $S$
contains physical source terms (zero for flat SRHD). In practice, we
advance $U$ on a Cartesian grid, reconstruct primitives to faces, and
compute fluxes via an approximate Riemann solver.

\paragraph{Assumptions.}
SRHD assumes a single-fluid ideal-gas EOS and neglects magnetic stresses.
It is appropriate for baseline jet tests and convergence studies.

\subsubsection{RMHD and GLM Cleaning}
Ideal RMHD satisfies
\begin{align}
\nabla_\mu (\rho u^\mu) &= 0, \\
\nabla_\mu T^{\mu\nu} &= 0, \\
\nabla_\mu {^*F}^{\mu\nu} &= 0,
\end{align}
with stress-energy tensor
\begin{equation}
T^{\mu\nu} = (\rho h + b^2) u^\mu u^\nu + \left(p + \frac{b^2}{2}\right) g^{\mu\nu} - b^\mu b^\nu,
\end{equation}
where $b^\mu$ is the magnetic 4-vector and $b^2 = b^\mu b_\mu$. GLM
cleaning enforces divergence control \cite{dedner2002, mignone2010}:
\begin{align}
\partial_t \mathbf{B} + \nabla \times \mathbf{E} + \nabla \psi &= 0, \\
\partial_t \psi + c_h^2 \nabla \cdot \mathbf{B} &= -c_p^2 \psi.
\end{align}
The GLM system introduces a damped cleaning wave, compatible with the
Riemann solvers used here.

\paragraph{Assumptions.}
AstroFD uses ideal RMHD with GLM cleaning; constrained transport is not
implemented. Reconnection is therefore numerical unless resistive or
non-ideal terms are enabled.

\subsubsection{GRHD/GRMHD: Valencia Form}
For fixed backgrounds, we adopt a 3+1 split with lapse $\alpha$, shift
$\beta^i$, and spatial metric $\gamma_{ij}$. The conservative update is
\begin{equation}
\partial_t (\sqrt{\gamma} U) + \partial_i (\sqrt{\gamma} F^i) = \sqrt{\gamma} S,
\end{equation}
with conserved variables
\begin{align}
D &= \rho W, \\
S_i &= (\rho h + b^2) W^2 v_i - \alpha b^0 b_i, \\
\tau &= (\rho h + b^2) W^2 - \left(p + \frac{b^2}{2}\right) - D - (\alpha b^0)^2.
\end{align}
Metric source terms are computed from the fixed background.

\paragraph{Assumptions.}
Spacetime is fixed and analytic; the Einstein equations are not evolved.

\subsubsection{Valencia Fluxes and Sources}
The Valencia formulation expresses the GRHD/GRMHD system as
\begin{equation}
\partial_t (\sqrt{\gamma} U) + \partial_i (\sqrt{\gamma} F^i) = \sqrt{\gamma} S,
\end{equation}
where $U = (D, S_j, \tau)$ and $F^i$ are
\begin{align}
F^i_D &= D (\alpha v^i - \beta^i), \\
F^i_{S_j} &= S_j (\alpha v^i - \beta^i) + \alpha \left(p + \frac{b^2}{2}\right)\delta^i{}_j - \alpha b^i b_j, \\
F^i_{\tau} &= \tau (\alpha v^i - \beta^i) + \alpha \left(p + \frac{b^2}{2}\right) v^i - \alpha b^0 b^i.
\end{align}
The source terms are
\begin{align}
S_D &= 0, \\
S_{S_j} &= \frac{\alpha}{2} T^{\mu\nu} \partial_j g_{\mu\nu}, \\
S_{\tau} &= \alpha \left(T^{\mu 0} \partial_\mu \ln \alpha - T^{\mu\nu} \Gamma^0_{\mu\nu}\right),
\end{align}
where $\Gamma^\alpha_{\mu\nu}$ are the Christoffel symbols. AstroFD uses
analytic fixed metrics (Minkowski, Schwarzschild, Kerr-Schild) and
computes these source terms from the prescribed background.

\paragraph{Magnetic 4-vector relations.}
In ideal RMHD, the lab-frame magnetic field $B^i$ and 4-vector $b^\mu$ are
related by
\begin{align}
b^0 &= W (B^i v_i), \\
b^i &= \frac{B^i}{W} + b^0 v^i,
\end{align}
and the ideal electric field satisfies $\mathbf{E} = -\mathbf{v} \times \mathbf{B}$.

\subsubsection{Causal Dissipation}
Israel--Stewart-type causal dissipation evolves bulk pressure $\Pi$,
shear stress $\pi^{\mu\nu}$, and heat flux $q^\mu$ with relaxation
\cite{israel1979, rezolla2013}:
\begin{align}
\tau_\Pi u^\alpha \nabla_\alpha \Pi + \Pi &= -\zeta \nabla_\alpha u^\alpha, \\
\tau_\pi u^\alpha \nabla_\alpha \pi^{\mu\nu} + \pi^{\mu\nu} &= 2 \eta \sigma^{\mu\nu}, \\
\tau_q u^\alpha \nabla_\alpha q^\mu + q^\mu &= -\kappa T \Delta^{\mu\nu} \nabla_\nu T.
\end{align}

\paragraph{Assumptions.}
Transport coefficients are user-specified and spatially uniform unless
encoded through source terms. The model is intended for exploratory
studies rather than calibrated microphysical viscosity.

\subsubsection{Two-Temperature Relaxation}
Electron and ion internal energies evolve with relaxation time $\tau_{ei}$:
\begin{align}
\partial_t (\rho e_e) + \nabla \cdot (\rho e_e \mathbf{v}) &= \rho \frac{e_i - e_e}{\tau_{ei}}, \\
\partial_t (\rho e_i) + \nabla \cdot (\rho e_i \mathbf{v}) &= \rho \frac{e_e - e_i}{\tau_{ei}}.
\end{align}

\paragraph{Assumptions.}
The two-temperature model uses a single relaxation timescale and does
not resolve kinetic-scale energy exchange. It is best interpreted as a
coarse-grained closure for parametric studies.

\subsubsection{H/He Non-Equilibrium Chemistry}
Species mass fractions $X_s$ satisfy
\begin{equation}
\partial_t (\rho X_s) + \nabla \cdot (\rho X_s \mathbf{v}) = \rho \dot{X}_s.
\end{equation}
The code uses collisional ionization and case-B recombination rates with
IMEX updates, following standard fits \cite{cen1992}.

\paragraph{Assumptions.}
The network is minimal and omits molecular species and metal cooling;
rates should be interpreted as illustrative rather than definitive.

\subsubsection{Passive Tracers}
Passive tracers $C_k$ obey
\begin{equation}
\partial_t (\rho C_k) + \nabla \cdot (\rho C_k \mathbf{v}) = 0,
\end{equation}
with inlet and ambient values set by configuration.

\subsubsection{Resistive and Non-Ideal MHD}
Resistive MHD uses Ohm's law
\begin{equation}
\mathbf{E} + \mathbf{v} \times \mathbf{B} = \eta \mathbf{J},
\end{equation}
with $\mathbf{J} = \nabla \times \mathbf{B}$. Optional Hall and ambipolar
corrections are included as explicit terms for controlled experiments
\cite{palenzuela2009}.

\paragraph{Assumptions.}
Non-ideal terms are applied explicitly and can be stiff; stability is
parameter-dependent and may require small timesteps or subcycling.

\subsubsection{SN-lite Gravity}
Newtonian gravity is applied as a source term with
\begin{equation}
\mathbf{g} = -G M(r) \frac{\mathbf{r}}{(r^2 + \epsilon^2)^{3/2}},
\end{equation}
using point-mass or monopole $M(r)$ options. Optionally, energy coupling
adds a pressure work term proportional to $\rho \mathbf{v} \cdot \mathbf{g}$.

\paragraph{Assumptions.}
The gravity model neglects relativistic corrections and assumes a static
potential.

\subsubsection{SN-lite Gain Heating/Cooling}
The gain model applies pressure updates
\begin{equation}
\Delta p = (\gamma - 1) (Q^+ - Q^-) \, \mathcal{W}(r) \, \mathcal{S}(\rho, p, t) \, \Delta t,
\end{equation}
with a radial weight $\mathcal{W}(r)$ and scaling $\mathcal{S}$. Implemented
radial weights include:
\begin{align}
\mathcal{W}_{\mathrm{sph}} &= \left(1 + \xi^2\right)^{-1}, \quad \xi = \frac{r - r_0}{r_1}, \\
\mathcal{W}_{\mathrm{pow}} &= \left(\frac{r_0}{r}\right)^{p}, \\
\mathcal{W}_{\mathrm{exp}} &= \exp\left(-\frac{|r - r_0|}{r_1}\right), \\
\mathcal{W}_{\mathrm{gauss}} &= \exp\left(-\left(\frac{r - r_0}{r_1}\right)^2\right).
\end{align}
Density and pressure scalings use optional exponents, and a time decay
factor $\exp[-(t - t_0)/\tau]$ can be applied.

\paragraph{Assumptions.}
Heating and cooling are parameterized and spatially prescribed; no
neutrino transport is solved.

\subsubsection{SN-lite Neutrino Lightbulb}
The lightbulb model applies a heating/cooling term using
\begin{align}
F_\nu &= \frac{L_\nu}{4 \pi r^2}, \\
\tau_{\mathrm{eff}} &= \max(\tau_0, \kappa \rho r), \\
Q^+ &= C_{\mathrm{abs}} F_\nu \epsilon_\nu e^{-\tau_{\mathrm{eff}}} \, \mathcal{W}(r), \\
Q^- &= C_{\mathrm{cool}} \rho T^{n},
\end{align}
with the same radial weight $\mathcal{W}(r)$ and optional time decay.

\paragraph{Assumptions.}
The lightbulb model uses simplified attenuation and cooling laws and is
not a replacement for multi-group neutrino transport.

\subsubsection{Radiation--Plasma Coupling}
Optional radiation coupling relaxes the gas temperature toward $T_{\rm rad}$:
\begin{equation}
\frac{dT}{dt} = -\lambda (T - T_{\rm rad}),
\end{equation}
with $T \approx p/\rho$ in code units and a configurable coupling rate.

\paragraph{Assumptions.}
This relaxation does not solve radiation transport and assumes a single
imposed $T_{\rm rad}$.

\subsection{Numerical Methods}
AstroFD uses a standard finite-volume method with reconstruction,
Riemann solvers, and SSPRK time integration. The method is designed to be
robust for shocks and discontinuities while remaining extensible to
higher-order reconstructions.

\subsubsection{Finite-Volume Discretization}
We update cell-averaged conserved variables on a Cartesian mesh with
ghost zones. The semi-discrete update is
\begin{equation}
\frac{d U_{i,j,k}}{dt} = -\frac{F^x_{i+1/2,j,k} - F^x_{i-1/2,j,k}}{\Delta x}
-\frac{F^y_{i,j+1/2,k} - F^y_{i,j-1/2,k}}{\Delta y}
-\frac{F^z_{i,j,k+1/2} - F^z_{i,j,k-1/2}}{\Delta z} + S_{i,j,k}.
\end{equation}
The timestep is set by a CFL constraint
\begin{equation}
\Delta t = C_{\mathrm{CFL}} \min\left(\frac{\Delta x}{a_{\max}}, \frac{\Delta y}{a_{\max}}, \frac{\Delta z}{a_{\max}}\right),
\end{equation}
where $a_{\max}$ is the maximum signal speed.

\subsubsection{Reconstruction}
Primitive variables are reconstructed to cell faces. MUSCL uses a limited
slope
\begin{equation}
\Delta q_i = \phi(\Delta q_{i-1/2}, \Delta q_{i+1/2}),
\end{equation}
with MC/minmod/van Leer limiters. PPM and WENO5 are available for higher
order accuracy \cite{colella1984, jiang1996}.

\subsubsection{Riemann Solvers}
HLLE provides a robust baseline. HLLC is used for hydro, and HLLD/full
HLLD for RMHD \cite{toro1999, miyoshi2005}. The solver is selected at
runtime.

\subsubsection{Time Integration}
We support SSPRK2 and SSPRK3 integration \cite{gottlieb2001}. SSPRK2 uses
\begin{align}
U^{(1)} &= U^n + \Delta t L(U^n), \\
U^{n+1} &= \frac{1}{2} U^n + \frac{1}{2} \left(U^{(1)} + \Delta t L(U^{(1)})\right).
\end{align}

\subsubsection{Source Term Coupling and IMEX}
Source terms are applied with operator splitting. For stiff terms, we
apply implicit relaxation with subcycled updates
\begin{align}
U^* &= U^n + \Delta t L(U^n), \\
U^{n+1} &= U^* + \Delta t S(U^{n+1}).
\end{align}

\subsubsection{Primitive Recovery}
Primitive recovery solves for $(\rho, p, v_i)$ given the conservative
state. RMHD recovery uses iterative inversion with fallback strategies
\cite{noble2006}.

\subsection{Algorithm Summary}
A single timestep proceeds as:
\begin{enumerate}
  \item Apply boundary conditions and nozzle inflow.
  \item Reconstruct primitives to faces (MUSCL/PPM/WENO).
  \item Solve Riemann problems at faces and compute fluxes.
  \item Update conserved variables with flux divergence.
  \item Apply source terms (gravity, GLM damping, dissipation, chemistry).
  \item Recover primitives and enforce floors/caps.
  \item Write diagnostics and outputs as configured.
\end{enumerate}

\subsection{Model Assumptions and Scope}
Table \ref{tab:model-assumptions} summarizes key assumptions across
physics modules.

\begin{table}[ht]
\centering
\begin{tabular}{l p{0.7\linewidth}}
\hline
Module & Assumptions and Scope \\
\hline
SRHD/RMHD & Ideal-gas EOS; single-fluid; flat spacetime for SRHD/RMHD. \\
GRHD/GRMHD & Fixed analytic metric; no Einstein evolution; Valencia form. \\
GLM Cleaning & Hyperbolic/parabolic cleaning; no constrained transport. \\
Dissipation & Israel--Stewart relaxation with user-specified coefficients. \\
Two-Temperature & Single relaxation time; coarse-grained coupling. \\
Chemistry & Minimal H/He network; no metals or molecules. \\
Resistive/Non-Ideal & Explicit source corrections; may be stiff. \\
SN-lite Gravity & Newtonian point-mass or monopole potential. \\
SN-lite Heating & Parametric gain profiles; no transport solver. \\
Lightbulb Neutrinos & Simplified attenuation and cooling laws. \\
Radiation Coupling & Relaxation to imposed $T_{\rm rad}$. \\
\hline
\end{tabular}
\caption{Summary of assumptions and model scope.}
\label{tab:model-assumptions}
\end{table}

\section{Validation and Demonstrations}
We track qualitative stability and quantitative thresholds in validation
scripts. Error norms are defined as
\begin{align}
L_1 &= \frac{1}{N} \sum_i |u_i - u_i^{\mathrm{ref}}|, \\
L_2 &= \left(\frac{1}{N} \sum_i (u_i - u_i^{\mathrm{ref}})^2\right)^{1/2}, \\
L_\infty &= \max_i |u_i - u_i^{\mathrm{ref}}|,
\end{align}
with an observed convergence rate
\begin{equation}
\mathcal{P} = \frac{\log(L(h_1)/L(h_2))}{\log(h_1/h_2)}.
\end{equation}
Validation suites cover reconstruction and limiter behavior, Riemann
solver checks, GR Kerr-Schild runs, orthonormal flux evaluation, restart
regression, and SN-lite tests (freefall, Sedov, stalled shock, and
lightbulb heating). These tests are automated in \texttt{tools/}.

\section{Example Results}
This section includes example figures and a compact diagnostics summary
table generated from representative validation runs. The figures can be
regenerated with \texttt{tools/make\_doc\_figures.py}. The results shown
here use \texttt{config/config\_doc\_jet.json} (SRHD jet),
\texttt{config/config\_doc\_rmhd.json} (RMHD jet), and
\texttt{config/config\_doc\_sn.json} (SN-lite Sedov).

\subsection{Jet Propagation Snapshot}
\begin{figure}[ht]
\centering
\includegraphics[width=0.9\linewidth]{figures/jet_rho_midZ.png}
\caption{Jet density slice at mid-Z from the latest run.}
\end{figure}

\subsection{Centerline Lorentz Factor}
\begin{figure}[ht]
\centering
\includegraphics[width=0.9\linewidth]{figures/centerline_gamma.png}
\caption{Centerline Lorentz factor profile from the latest run.}
\end{figure}

\subsection{RMHD divB Control}
\begin{figure}[ht]
\centering
\includegraphics[width=0.9\linewidth]{figures/divb_max.png}
\caption{divB max over time from the latest RMHD run segment.}
\end{figure}

\subsection{SN-lite Shock Evolution}
\begin{figure}[ht]
\centering
\includegraphics[width=0.9\linewidth]{figures/sn_shock_radius.png}
\caption{SN-lite shock radius evolution from the latest run segment.}
\end{figure}

\subsection{Diagnostics Summary Table}
\input{figures/validation_summary.tex}
Diagnostics reported as N/A indicate quantities not enabled for that
configuration.

\section{Discussion}\label{sec:discussion}
AstroFD emphasizes transparent, modular physics and numerical methods to
support controlled studies. The current scope focuses on fixed
background metrics and parameterized SN-lite heating to enable rapid and
reproducible experiments; higher-fidelity transport and dynamic
spacetime evolution are planned extensions rather than excluded design
goals. Future work will incorporate more detailed EOS options, expanded
benchmark suites, and more complete transport models.

\section{Conclusion}
We presented AstroFD, a modular relativistic solver designed for
systematic comparisons across physics models and numerical schemes. The
code supports SRHD/RMHD/GRHD/GRMHD on fixed backgrounds, optional causal
dissipation, two-temperature coupling, non-equilibrium chemistry, and
SN-lite source terms. Validation tools and configuration tables are
provided to facilitate reproducible studies and to serve as a foundation
for future extensions.

\section*{Acknowledgments}
The author acknowledges helpful discussions and support from collaborators
and the Georgia Institute of Technology. This section will be expanded in
future versions.

\appendix
\section{Valencia Derivation Details}
Let $n^\mu$ be the unit normal to constant-time slices and
$\gamma_{\mu\nu} = g_{\mu\nu} + n_\mu n_\nu$ be the spatial projector.
We decompose the 4-velocity as $u^\mu = W (n^\mu + v^\mu)$ with
$v^\mu n_\mu = 0$. The conserved energy density and momentum are
\begin{align}
E &= T^{\mu\nu} n_\mu n_\nu, \\
S_i &= -T^{\mu\nu} n_\mu \gamma_{\nu i}, \\
S_{ij} &= T^{\mu\nu} \gamma_{\mu i} \gamma_{\nu j}.
\end{align}
For ideal MHD, $b^\mu$ satisfies $b^\mu u_\mu = 0$, and the ideal electric
field is $\mathbf{E} = -\mathbf{v} \times \mathbf{B}$. The Valencia system
then follows from projecting $\nabla_\mu T^{\mu\nu} = 0$ along $n^\nu$ and
within the spatial hypersurface.

\section{Configuration Parameters}
Tables in this section list the default configuration keys from
\texttt{utils/settings.py}. Units are code units unless stated otherwise.
\input{figures/config_table.tex}

\bibliographystyle{unsrt}
\bibliography{astrofd_refs}

\end{document}
